<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <link rel="icon" href="cima.png" type="image/x-icon">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loja - Computadores & Jogos</title>
    <link rel="stylesheet" href="loja.css">
</head>

<body>
    <div class="draggable-cart-widget" id="draggableCartWidget">
        <div class="draggable-cart-header">
            <span class="draggable-cart-badge" id="draggableCartBadge">0</span>
            <img src="cart.png" alt="Carrinho" height="35px">
        </div>
        <div class="draggable-cart-tooltip">Pressione para mover</div>
    </div>

    <header>
        <div class="header-container">
            <img src="logo.png" alt="Logo Equipe Alfa" class="logo">
            <button class="cart-btn2" id="openCartHeader" title="Abrir carrinho">
                <img class="cart-icon" src="cart.png" alt="Carrinho" height="35px" style="padding-left: 10px;">
                <span class="cart-count" id="cartCountHeader">0</span>
            </button>
            <div class="hamburger" id="hamburger">
                <div></div>
                <div></div>
                <div></div>
            </div>
            <nav class="navbar" id="navMenu">
                <a href="#">Início</a>
                <a href="#">Monte seu PC</a>
                <a href="#">Departamentos</a>
                <button class="cart-btn1" id="openCartNav" title="Abrir carrinho">
                    <img class="cart-icon" src="cart.png" alt="Carrinho" height="35px">
                    <span class="cart-count" id="cartCountNav">0</span>
                </button>
            </nav>
        </div>
    </header>

    <div class="cart-drawer" id="cartDrawer" aria-hidden="true">
        <h3>Carrinho</h3>
        <div class="cart-box">
            <div id="cartItems"></div>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
            <strong>Total:</strong><strong id="cartTotal">R$ 0,00</strong>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px">
            <button class="btn" id="checkout">Finalizar</button>
            <button class="btn ghost" id="closeCart">Fechar</button>
        </div>
    </div>

    <div class="cart-bottom-sheet" id="cartBottomSheet" aria-hidden="true">
        <div class="cart-bottom-header">
            <h3>Carrinho</h3>
            <button id="closeCartBottom" class="btn ghost">Fechar</button>
        </div>
        <div class="cart-box" id="cartItems"></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
            <strong>Total:</strong>
            <strong id="cartTotal">R$ 0,00</strong>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px">
            <button class="btn" id="checkoutMobile">Finalizar</button>
        </div>
    </div>

    <main>
        <aside class="sidebar">
            <!-- Campo de pesquisa removido conforme solicitado -->
            <div class="filter-group">
                <h4>Categoria</h4>
                <div><label><input type="radio" name="cat" value="all" checked /> Todos</label></div>
                <fieldset>
                    <div><label><input type="radio" name="cat" value="computadores"/><legend> Computadores</legend></label></div>
                    <div><label><input type="radio" name="cat" value="periféricos"/><legend> Periféricos</legend></label></div>
                    <div><label><input type="radio" name="cat" value="hardware"/><legend> Hardware</legend></label></div>
                </fieldset>
            </div>
            <div class="filter-group">
                <h4>Ordenar</h4>
                <select id="sort">
                    <option value="default">Padrão</option>
                    <option value="price-asc">Preço: menor</option>
                    <option value="price-desc">Preço: maior</option>
                </select>
            </div>
            <div style="margin-top:12px">
                <button class="btn" id="applyFilters">Aplicar</button>
                <button class="btn ghost" id="clearFilters">Limpar</button>
            </div>
        </aside>
        <div class="topbar-mobile">
            <div class="search">
                <input id="searchMobile" type="search" placeholder="Procurar por título..." autocomplete="off"
                    autocorrect="off" autocapitalize="off" spellcheck="false" />
            </div>
        </div>
        <section>
            <div class="carrossel-de-propagandas">
                <div class="carousel-track">
                    <div class="carousel-slide"><img src="images/carrossel/teste banner.png" alt="Promo 1"></div>
                    <div class="carousel-slide"><img src="images/carrossel/teste banner 2.png" alt="Promo 2"></div>
                    <div class="carousel-slide"><img src="images/carrossel/teste banner 3.png" alt="Promo 3"></div>
                </div>
                <button class="carousel-btn prev" aria-label="Anterior"></button>
                <button class="carousel-btn next" aria-label="Próximo"></button>
                <div class="carousel-dots" aria-hidden="false"></div>
            </div>

            <div class="topbar">
                <div class="search">
                    <!-- Desktop: id "search" mantém compatibilidade com applyFilters() -->
                    <input id="search" type="search" placeholder="Pesquise seu futuro item..." autocomplete="off"
                        autocorrect="off" autocapitalize="off" spellcheck="false" />
                </div>
                <div style="min-width:180px;text-align:right;color:var(--muted)">
                    Mostrando <span id="shownCount">0</span> produtos
                </div>
            </div>

            <div class="products" style="min-width:180px;text-align:right;color:var(--muted);">
                Mostrando <span id="shownCount2">0</span> produtos
            </div>

            <div class="product-list" id="products"></div>
            <div class="pagination" id="pagination"></div>
        </section>
    </main>

    <footer>© Equipe Alfa Informática — Todos os direitos reservados</footer>

    <!-- global.js (mantém PRODUCTS, lógica de carrinho, etc.) -->
    <script src="global.js"></script>

    <!-- Reinsere o script que renderiza produtos / filtros / paginação (o conteúdo que estava antes dentro do loja.html original) -->
    <script>
        (function initAdsCarouselAuto() {
            const root = document.querySelector('.carrossel-de-propagandas');
            if (!root) return;
            const track = root.querySelector('.carousel-track');
            const slides = Array.from(root.querySelectorAll('.carousel-slide'));
            const dotsWrap = root.querySelector('.carousel-dots');
            const total = slides.length;
            let index = 0;
            const interval = 3500;
            let timer = null;
            function buildDots() {
                if (!dotsWrap) return;
                dotsWrap.innerHTML = '';
                slides.forEach((_, i) => {
                    const b = document.createElement('button');
                    b.type = 'button';
                    b.dataset.index = i;
                    b.addEventListener('click', () => { goTo(i); restart(); });
                    if (i === 0) b.classList.add('active');
                    dotsWrap.appendChild(b);
                });
            }
            function update() {
                track.style.transform = `translateX(-${index * 100}%)`;
                if (dotsWrap) Array.from(dotsWrap.children).forEach((d, i) => d.classList.toggle('active', i === index));
            }
            function next() { index = (index + 1) % total; update(); }
            function goTo(i) { index = (i + total) % total; update(); }
            function start() { stop(); timer = setInterval(next, interval); }
            function stop() { if (timer) { clearInterval(timer); timer = null; } }
            function restart() { start(); }
            root.addEventListener('mouseenter', stop);
            root.addEventListener('mouseleave', start);
            let startX = 0;
            root.addEventListener('touchstart', e => { stop(); startX = e.touches[0].clientX; });
            root.addEventListener('touchend', e => {
                const dx = e.changedTouches[0].clientX - startX;
                if (dx > 40) { index = (index - 1 + total) % total; update(); }
                if (dx < -40) { index = (index + 1) % total; update(); }
                start();
            });
            buildDots();
            update();
            start();
        })();

        // estado de produtos/paginação (usa PRODUCTS do global.js)
        const state = { products: PRODUCTS.slice(), pageSize: 8, currentPage: 1 };

        function renderPage(page = 1) {
            const container = el('products');
            const total = state.products.length;
            const pageSize = state.pageSize;
            const totalPages = Math.max(1, Math.ceil(total / pageSize));
            page = Math.max(1, Math.min(page, totalPages));
            state.currentPage = page;
            try { localStorage.setItem('loja.currentPage', String(page)); } catch (e) { }
            const start = (page - 1) * pageSize;
            const pageItems = state.products.slice(start, start + pageSize);
            container.innerHTML = '';
            pageItems.forEach(p => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="thumb">
                        <img src="${(p.images && p.images.length) ? p.images[0] : DEFAULT_PRODUCT_IMAGE}" alt="${p.title}">
                    </div>
                    <div style="flex:1">
                        <div style="font-weight:700">${p.title}</div>
                        <div style="font-size:13px;color:var(--muted)">${p.desc}</div>
                    </div>
                    <div class="meta">
                        <div class="stock-status ${p.stock > 0 ? 'em-estoque' : 'esgotado'}">
                            ${p.stock > 0 ? 'Em Estoque' : 'Esgotado'}
                        </div>
                        <div class="price-container-card">
                            <div class="price-old">${money(p.price * 1.15)}</div>
                            <div class="price-discounted">${money(p.price)}</div>
                            <div class="discount-tag">15% OFF no PIX</div>
                        </div>
                        <div class="actions">
                            <button class="btn" data-id="${p.id}" onclick="addToCart(${p.id})" ${p.stock <= 0 ? 'disabled' : ''}>
                                ${p.stock > 0 ? 'Adicionar' : 'Esgotado'}
                            </button>
                        </div>
                    </div>
                `;
                card.style.cursor = 'pointer';
                card.addEventListener('click', function (e) {
                    if (e.target.tagName.toLowerCase() === 'button') return;
                    window.location.href = `produto.html?id=${p.id}`;
                });
                container.appendChild(card);
            });
            const from = total === 0 ? 0 : start + 1;
            const to = start + pageItems.length;
            const label = `${from}-${to} de ${total}`;
            if (el('shownCount')) el('shownCount').textContent = label;
            if (el('shownCount2')) el('shownCount2').textContent = label;
            renderPagination(totalPages, page);
        }

        function renderPagination(totalPages, current) {
            const pag = el('pagination');
            if (!pag) return;
            pag.innerHTML = '';
            const createBtn = (text, cls, disabled, handler) => {
                const b = document.createElement('button');
                b.type = 'button';
                b.className = cls || 'page-btn';
                b.textContent = text;
                if (disabled) b.disabled = true;
                b.addEventListener('click', handler);
                return b;
            };
            pag.appendChild(createBtn('Anterior', 'page-btn nav', current === 1, () => renderPage(current - 1)));
            for (let i = 1; i <= totalPages; i++) {
                const btn = createBtn(i, 'page-btn' + (i === current ? ' active' : ''), false, () => renderPage(i));
                pag.appendChild(btn);
            }
            pag.appendChild(createBtn('Próximo', 'page-btn nav', current === totalPages, () => renderPage(current + 1)));
        }

        function applyFilters() {
            const category = document.querySelector('input[name="cat"]:checked').value;
            // usa o input com id 'search' (presente no topbar desktop)
            const searchInput = el('search');
            const searchQuery = (searchInput && searchInput.value) ? searchInput.value.trim().toLowerCase() : '';
            const sort = el('sort').value;

            let list = PRODUCTS.slice();

            // Filtro por categoria
            if (category !== 'all') {
                list = list.filter(p => p.category === category);
            }

            // Filtro por busca (título, descrição e palavras-chave relacionadas)
            if (searchQuery) {
                list = list.filter(p =>
                    p.title.toLowerCase().includes(searchQuery) ||
                    p.desc.toLowerCase().includes(searchQuery) ||
                    (p.tags && p.tags.some(tag => tag.toLowerCase().includes(searchQuery)))
                );
            }

            // Ordenação
            if (sort === 'price-asc') list.sort((a, b) => a.price - b.price);
            if (sort === 'price-desc') list.sort((a, b) => b.price - a.price);

            state.products = list;
            renderPage(1); // sempre renderiza da primeira página
        }

        function clearFilters() {
            document.querySelector('input[name="cat"][value="all"]').checked = true;
            if (el('search')) el('search').value = '';
            el('sort').value = 'default';
            state.products = PRODUCTS.slice();
            renderPage(1);
        }

        el('applyFilters').addEventListener('click', applyFilters);
        el('clearFilters').addEventListener('click', clearFilters);

        // Busca ao apertar Enter no input desktop
        el('search').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') applyFilters();
        });

        // Busca automática enquanto digita no desktop
        el('search').addEventListener('input', () => {
            applyFilters();
        });

        // Mobile: escuta searchMobile, copia para #search e aplica filtros
        const mobileSearch = el('searchMobile');
        if (mobileSearch) {
            mobileSearch.addEventListener('input', debounce(() => {
                if (el('search')) el('search').value = mobileSearch.value;
                applyFilters();
            }, 220));
            mobileSearch.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    if (el('search')) el('search').value = mobileSearch.value;
                    applyFilters();
                }
            });
        }

        el('checkout')?.addEventListener('click', () => {
            alert('Checkout de exemplo — implementar integração de pagamento.');
        });

        // ===== utilitários e layout de sidebar fixo (copiados do original) =====
        let initialSidebarHeight = null;
        function debounce(fn, wait) {
            let t;
            return function (...args) {
                clearTimeout(t);
                t = setTimeout(() => fn.apply(this, args), wait);
            };
        }
        function computeInitialSidebarHeight() {
            if (initialSidebarHeight !== null) return;
            const sb = document.querySelector('.sidebar');
            if (!sb) return;
            const prev = sb.style.height;
            sb.style.height = 'auto';
            const h = sb.scrollHeight;
            initialSidebarHeight = h;
            sb.style.height = prev || '';
        }
        function applyFixedSidebarHeight() {
            const sb = document.querySelector('.sidebar');
            if (!sb) return;
            const vw = window.innerWidth || document.documentElement.clientWidth;
            if (vw >= 700 && initialSidebarHeight) {
                const maxHeight = window.innerHeight - 40; // margem top/bottom
                sb.style.height = Math.min(initialSidebarHeight, maxHeight) + 'px';
                sb.style.overflowY = 'auto';
            } else {
                sb.style.height = 'auto';
                sb.style.overflowY = 'visible';
            }
        }

        requestAnimationFrame(() => requestAnimationFrame(() => {
            computeInitialSidebarHeight();
            applyFixedSidebarHeight();
            state.products = PRODUCTS.slice();
            let savedPage = 1;
            try {
                const v = parseInt(localStorage.getItem('loja.currentPage'), 10);
                if (!Number.isNaN(v) && v > 0) savedPage = v;
            } catch (e) { }
            renderPage(savedPage);
            updateCartUI();
        }));
        const _fixDeb = debounce(() => {
            applyFixedSidebarHeight();
        }, 120);
        window.addEventListener('resize', _fixDeb);
    </script>

    <!-- scripts de global.js já carregados acima: setupHamburgerMenu, cart handlers, etc. -->
</body>

</html>